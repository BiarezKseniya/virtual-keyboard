const keyboards = [
  {
    lang: 'en',
    keyboard: [
      [
        {
          keyName: '`',
          keyCode: '`',
          caps: false,
          shift: '-',
        },
        {
          keyName: '1',
          keyCode: '1',
          caps: false,
          shift: '!',
        },
        {
          keyName: '2',
          keyCode: '2',
          caps: false,
          shift: '@',
        },
        {
          keyName: '3',
          keyCode: '3',
          caps: false,
          shift: '#',
        },
        {
          keyName: '4',
          keyCode: '4',
          caps: false,
          shift: '$',
        },
        {
          keyName: '5',
          keyCode: '5',
          caps: false,
          shift: '%',
        },
        {
          keyName: '6',
          keyCode: '6',
          caps: false,
          shift: '^',
        },
        {
          keyName: '7',
          keyCode: '7',
          caps: false,
          shift: '&',
        },
        {
          keyName: '8',
          keyCode: '8',
          caps: false,
          shift: '*',
        },
        {
          keyName: '9',
          keyCode: '9',
          caps: false,
          shift: '(',
        },
        {
          keyName: '0',
          keyCode: '0',
          caps: false,
          shift: ')',
        },
        {
          keyName: '-',
          keyCode: '-',
          caps: false,
          shift: '_',
        },
        {
          keyName: '=',
          keyCode: '=',
          caps: false,
          shift: '+',
        },
        {
          keyName: 'Backspace',
          keyCode: 'Backspace',
          caps: false,
        },
      ],
      [
        {
          keyName: 'Tab',
          keyCode: 'Tab',
          caps: false,
        },
        {
          keyName: 'q',
          keyCode: 'q',
          caps: true,
        },
        {
          keyName: 'w',
          keyCode: 'w',
          caps: true,
        },
        {
          keyName: 'e',
          keyCode: 'e',
          caps: true,
        },
        {
          keyName: 'r',
          keyCode: 'r',
          caps: true,
        },
        {
          keyName: 't',
          keyCode: 't',
          caps: true,
        },
        {
          keyName: 'y',
          keyCode: 'y',
          caps: true,
        },
        {
          keyName: 'u',
          keyCode: 'u',
          caps: true,
        },
        {
          keyName: 'i',
          keyCode: 'i',
          caps: true,
        },
        {
          keyName: 'o',
          keyCode: 'o',
          caps: true,
        },
        {
          keyName: 'p',
          keyCode: 'p',
          caps: true,
        },
        {
          keyName: '[',
          keyCode: '[',
          caps: false,
          shift: '{',
        },
        {
          keyName: ']',
          keyCode: ']',
          caps: false,
          shift: '}',
        },
        {
          keyName: '\\',
          keyCode: '\\',
          caps: false,
          shift: '|',
        },
      ],
      [
        {
          keyName: 'CapsLock',
          keyCode: 'CapsLock',
          caps: false,
        },
        {
          keyName: 'a',
          keyCode: 'a',
          caps: true,
        },
        {
          keyName: 's',
          keyCode: 's',
          caps: true,
        },
        {
          keyName: 'd',
          keyCode: 'd',
          caps: true,
        },
        {
          keyName: 'f',
          keyCode: 'f',
          caps: true,
        },
        {
          keyName: 'g',
          keyCode: 'g',
          caps: true,
        },
        {
          keyName: 'h',
          keyCode: 'h',
          caps: true,
        },
        {
          keyName: 'j',
          keyCode: 'j',
          caps: true,
        },
        {
          keyName: 'k',
          keyCode: 'k',
          caps: true,
        },
        {
          keyName: 'l',
          keyCode: 'l',
          caps: true,
        },
        {
          keyName: ';',
          keyCode: ';',
          caps: false,
          shift: ':',
        },
        {
          keyName: "'",
          keyCode: "'",
          caps: false,
          shift: '"',
        },
        {
          keyName: 'Enter',
          keyCode: 'Enter',
          caps: false,
        },
      ],
      [
        {
          keyName: 'Shift',
          keyCode: 'Shift',
          caps: false,
        },
        {
          keyName: 'z',
          keyCode: 'z',
          caps: true,
        },
        {
          keyName: 'x',
          keyCode: 'x',
          caps: true,
        },
        {
          keyName: 'c',
          keyCode: 'c',
          caps: true,
        },
        {
          keyName: 'v',
          keyCode: 'v',
          caps: true,
        },
        {
          keyName: 'b',
          keyCode: 'b',
          caps: true,
        },
        {
          keyName: 'n',
          keyCode: 'n',
          caps: true,
        },
        {
          keyName: 'm',
          keyCode: 'm',
          caps: true,
        },
        {
          keyName: ',',
          keyCode: ',',
          caps: false,
          shift: '<',
        },
        {
          keyName: '.',
          keyCode: '.',
          caps: false,
          shift: '>',
        },
        {
          keyName: '/',
          keyCode: '/',
          caps: false,
          shift: '?',
        },
        {
          keyName: '▲',
          keyCode: 'ArrowUp',
          caps: false,
        },
        {
          keyName: 'Shift',
          keyCode: 'Shift',
          caps: false,
        },
      ],
      [
        {
          keyName: 'Ctrl',
          keyCode: 'Ctrl',
          caps: false,
        },
        {
          keyName: 'Win',
          keyCode: 'Meta',
          caps: false,
        },
        {
          keyName: 'Alt',
          keyCode: 'Alt',
          caps: false,
        },
        {
          keyName: '',
          keyCode: '',
          caps: false,
        },
        {
          keyName: 'Alt',
          keyCode: 'Alt',
          caps: false,
        },
        {
          keyName: '◄',
          keyCode: 'ArrowLeft',
          caps: false,
        },
        {
          keyName: '▼',
          keyCode: 'ArrowDown',
          caps: false,
        },
        {
          keyName: '►',
          keyCode: 'ArrowRight',
          caps: false,
        },
        {
          keyName: 'Ctrl',
          keyCode: 'Ctrl',
          caps: false,
        },
      ],
    ],
  },
  {
    lang: 'ru',
    keyboard: [
      [
        {
          keyName: 'ё',
          keyCode: 'ё',
          caps: true,
        },
        {
          keyName: '1',
          keyCode: '1',
          caps: false,
          shift: '!',
        },
        {
          keyName: '2',
          keyCode: '2',
          caps: false,
          shift: '"',
        },
        {
          keyName: '3',
          keyCode: '3',
          caps: false,
          shift: '№',
        },
        {
          keyName: '4',
          keyCode: '4',
          caps: false,
          shift: ';',
        },
        {
          keyName: '5',
          keyCode: '5',
          caps: false,
          shift: '%',
        },
        {
          keyName: '6',
          keyCode: '6',
          caps: false,
          shift: ':',
        },
        {
          keyName: '7',
          keyCode: '7',
          caps: false,
          shift: '?',
        },
        {
          keyName: '8',
          keyCode: '8',
          caps: false,
          shift: '*',
        },
        {
          keyName: '9',
          keyCode: '9',
          caps: false,
          shift: '(',
        },
        {
          keyName: '0',
          keyCode: '0',
          caps: false,
          shift: ')',
        },
        {
          keyName: '-',
          keyCode: '-',
          caps: false,
          shift: '_',
        },
        {
          keyName: '=',
          keyCode: '=',
          caps: false,
          shift: '+',
        },
        {
          keyName: 'Backspace',
          keyCode: 'Backspace',
          caps: false,
        },
      ],
      [
        {
          keyName: 'Tab',
          keyCode: 'Tab',
          caps: false,
        },
        {
          keyName: 'й',
          keyCode: 'й',
          caps: true,
        },
        {
          keyName: 'ц',
          keyCode: 'ц',
          caps: true,
        },
        {
          keyName: 'у',
          keyCode: 'у',
          caps: true,
        },
        {
          keyName: 'к',
          keyCode: 'к',
          caps: true,
        },
        {
          keyName: 'е',
          keyCode: 'е',
          caps: true,
        },
        {
          keyName: 'н',
          keyCode: 'н',
          caps: true,
        },
        {
          keyName: 'г',
          keyCode: 'г',
          caps: true,
        },
        {
          keyName: 'ш',
          keyCode: 'ш',
          caps: true,
        },
        {
          keyName: 'щ',
          keyCode: 'щ',
          caps: true,
        },
        {
          keyName: 'з',
          keyCode: 'з',
          caps: true,
        },
        {
          keyName: 'х',
          keyCode: 'х',
          caps: true,
        },
        {
          keyName: 'ъ',
          keyCode: 'ъ',
          caps: true,
        },
        {
          keyName: '\\',
          keyCode: '\\',
          caps: false,
          shift: '/',
        },
      ],
      [
        {
          keyName: 'CapsLock',
          keyCode: 'CapsLock',
          caps: false,
        },
        {
          keyName: 'ф',
          keyCode: 'ф',
          caps: true,
        },
        {
          keyName: 'ы',
          keyCode: 'ы',
          caps: true,
        },
        {
          keyName: 'в',
          keyCode: 'в',
          caps: true,
        },
        {
          keyName: 'а',
          keyCode: 'а',
          caps: true,
        },
        {
          keyName: 'п',
          keyCode: 'п',
          caps: true,
        },
        {
          keyName: 'р',
          keyCode: 'р',
          caps: true,
        },
        {
          keyName: 'о',
          keyCode: 'о',
          caps: true,
        },
        {
          keyName: 'л',
          keyCode: 'л',
          caps: true,
        },
        {
          keyName: 'д',
          keyCode: 'д',
          caps: true,
        },
        {
          keyName: 'ж',
          keyCode: 'ж',
          caps: true,
        },
        {
          keyName: 'э',
          keyCode: 'э',
          caps: true,
        },
        {
          keyName: 'Enter',
          keyCode: 'Enter',
          caps: false,
        },
      ],
      [
        {
          keyName: 'Shift',
          keyCode: 'Shift',
          caps: false,
        },
        {
          keyName: 'я',
          keyCode: 'я',
          caps: true,
        },
        {
          keyName: 'ч',
          keyCode: 'ч',
          caps: true,
        },
        {
          keyName: 'с',
          keyCode: 'с',
          caps: true,
        },
        {
          keyName: 'м',
          keyCode: 'м',
          caps: true,
        },
        {
          keyName: 'и',
          keyCode: 'и',
          caps: true,
        },
        {
          keyName: 'т',
          keyCode: 'т',
          caps: true,
        },
        {
          keyName: 'ь',
          keyCode: 'ь',
          caps: true,
        },
        {
          keyName: 'б',
          keyCode: 'б',
          caps: true,
        },
        {
          keyName: 'ю',
          keyCode: 'ю',
          caps: true,
        },
        {
          keyName: '.',
          keyCode: '.',
          caps: false,
          shift: ',',
        },
        {
          keyName: '▲',
          keyCode: 'ArrowUp',
          caps: false,
        },
        {
          keyName: 'Shift',
          keyCode: 'Shift',
          caps: false,
        },
      ],
      [
        {
          keyName: 'Ctrl',
          keyCode: 'Ctrl',
          caps: false,
        },
        {
          keyName: 'Win',
          keyCode: 'Meta',
          caps: false,
        },
        {
          keyName: 'Alt',
          keyCode: 'Alt',
          caps: false,
        },
        {
          keyName: '',
          keyCode: '',
          caps: false,
        },
        {
          keyName: 'Alt',
          keyCode: 'Alt',
          caps: false,
        },
        {
          keyName: '◄',
          keyCode: 'ArrowLeft',
          caps: false,
        },
        {
          keyName: '▼',
          keyCode: 'ArrowDown',
          caps: false,
        },
        {
          keyName: '►',
          keyCode: 'ArrowRight',
          caps: false,
        },
        {
          keyName: 'Ctrl',
          keyCode: 'Ctrl',
          caps: false,
        },
      ],
    ],
  },
];

let lang = 'en';

function createLayout() {
  const main = document.createElement('main');
  main.classList.add('main');

  const keyboardLabel = document.createElement('label');
  keyboardLabel.classList.add('area-label');
  keyboardLabel.innerText = 'Virtual keyboard';

  const chooseLang = document.createElement('div');
  chooseLang.classList.add('choose-lang');

  const chooseLangOption1 = document.createElement('div');
  chooseLangOption1.classList.add('choose-lang__option');

  const chooseLangInput1 = document.createElement('input');
  chooseLangInput1.setAttribute('name', 'lang');
  chooseLangInput1.setAttribute('type', 'radio');
  chooseLangInput1.setAttribute('id', 'en');
  chooseLangInput1.setAttribute('value', 'en');
  chooseLangInput1.setAttribute('checked', true);
  chooseLangInput1.classList.add('choose-lang__option');

  const labelOption1 = document.createElement('label');
  labelOption1.setAttribute('for', 'en');
  labelOption1.innerText = 'English';

  const chooseLangOption2 = document.createElement('div');
  chooseLangOption2.classList.add('choose-lang__option');

  const chooseLangInput2 = document.createElement('input');
  chooseLangInput2.name = 'lang';
  chooseLangInput2.type = 'radio';
  chooseLangInput2.id = 'ru';
  chooseLangInput2.value = 'ru';
  chooseLangInput2.classList.add('choose-lang__option');

  const labelOption2 = document.createElement('label');
  labelOption2.setAttribute('for', 'ru');
  labelOption2.innerText = 'Russian';

  const typingArea = document.createElement('textarea');
  typingArea.setAttribute('rows', '8');
  typingArea.setAttribute('cols', '75');
  typingArea.setAttribute('placeholder', 'Start typing here');
  typingArea.setAttribute('id', 'typing-area');

  const keyboard = document.createElement('div');
  keyboard.classList.add('keyboard');

  main.appendChild(keyboardLabel);
  chooseLangOption1.appendChild(chooseLangInput1);
  chooseLangOption1.appendChild(labelOption1);
  chooseLang.appendChild(chooseLangOption1);
  chooseLangOption2.appendChild(chooseLangInput2);
  chooseLangOption2.appendChild(labelOption2);
  chooseLang.appendChild(chooseLangOption2);
  main.appendChild(chooseLang);
  main.appendChild(typingArea);
  main.appendChild(keyboard);
  document.body.appendChild(main);
}

function printToTextArea(symbol) {
  const textArea = document.querySelector('#typing-area');
  const startPos = textArea.selectionStart;
  const endPos = textArea.selectionEnd;

  textArea.value = textArea.value.substring(0, startPos) + symbol
    + textArea.value.substring(endPos, textArea.value.length);
  textArea.selectionStart = startPos + symbol.length;
  textArea.selectionEnd = startPos + symbol.length;
  textArea.focus();
}

function backspaceTextArea() {
  const textArea = document.querySelector('#typing-area');
  let startPos = textArea.selectionStart;
  const endPos = textArea.selectionEnd;

  if (startPos === endPos) {
    if (startPos === 0) return;
    startPos -= 1;
  }

  textArea.value = textArea.value.substring(0, startPos)
    + textArea.value.substring(endPos, textArea.value.length);
  textArea.selectionStart = startPos;
  textArea.selectionEnd = startPos;
  textArea.focus();
}

let capslock = false;
let shift = false;
let rerenderKeyboard;

function toggleCaps() {
  capslock = !capslock;
  rerenderKeyboard();
}

function btnHandler(keyCode, symbol) {
  switch (keyCode) {
    case 'Backspace':
      backspaceTextArea();
      break;
    case 'Tab':
      printToTextArea('\t');
      break;
    case 'Enter':
      printToTextArea('\n');
      break;
    case '':
      printToTextArea(' ');
      break;
    default: {
      printToTextArea(symbol);
      break;
    }
  }
}

function shiftDown() {
  if (!shift) {
    shift = true;
    rerenderKeyboard();
  }
}

function shiftUp() {
  shift = false;
  rerenderKeyboard();
}

rerenderKeyboard = function renderKeyboard() {
  const mainContainer = document.querySelector('.keyboard');
  mainContainer.innerHTML = '';
  let keyboard = [];

  keyboard = keyboards.find((element) => element.lang === lang).keyboard;

  for (let i = 0; i < 5; i += 1) {
    const keyboardRaw = document.createElement('div');
    keyboardRaw.classList.add('keyboard__raw');
    for (let j = 0; j < keyboard[i].length; j += 1) {
      const currentKey = keyboard[i][j];
      const keyboardBtn = document.createElement('button');
      keyboardBtn.setAttribute('type', 'button');
      keyboardBtn.classList.add('keyboard__key');

      if ((capslock || shift) && !(capslock && shift) && currentKey.caps) {
        keyboardBtn.innerText = currentKey.keyName.toUpperCase();
      } else if (shift && currentKey.shift) {
        keyboardBtn.innerText = currentKey.shift;
      } else {
        keyboardBtn.innerText = currentKey.keyName;
      }

      keyboardBtn.classList.add(currentKey.keyCode ? currentKey.keyCode.toLowerCase() : 'space');
      if (currentKey.caps) {
        keyboardBtn.classList.add('caps');
      }

      if (currentKey.keyCode === 'Shift') {
        keyboardBtn.addEventListener('mousedown', shiftDown);
        keyboardBtn.addEventListener('mouseup', shiftUp);
        if (shift) {
          keyboardBtn.classList.add('active');
        }
      } else if (currentKey.keyCode === 'CapsLock') {
        keyboardBtn.addEventListener('click', toggleCaps);
        if (capslock) {
          keyboardBtn.classList.add('active');
        }
      } else {
        keyboardBtn.addEventListener('click', btnHandler.bind(this, currentKey.keyCode, keyboardBtn.innerText));
      }

      keyboardRaw.appendChild(keyboardBtn);
    }
    mainContainer.appendChild(keyboardRaw);
  }
};

document.addEventListener('load', createLayout());
document.addEventListener('load', rerenderKeyboard());
